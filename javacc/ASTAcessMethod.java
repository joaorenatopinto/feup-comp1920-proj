/* Generated By:JJTree: Do not edit this line. ASTAcessMethod.java Version 4.3 */
/* JavaCCOptions:MULTI=true,NODE_USES_PARSER=false,VISITOR=false,TRACK_TOKENS=false,NODE_PREFIX=AST,NODE_EXTENDS=,NODE_FACTORY=,SUPPORT_CLASS_VISIBILITY_PUBLIC=true */
import java.util.*;

public
class ASTAcessMethod extends SimpleNode {
  String ast_identifier;
  String ast_method;

  public ASTAcessMethod(int id) {
    super(id);
  }

  public ASTAcessMethod(Compiler p, int id) {
    super(p, id);
  }

  @Override
  public int process(String className) {
    System.out.println(this.getClass());
    if (this.children != null)
      for(int i = 0; i < this.children.length; i++) {
        ((SimpleNode)this.children[i]).process(className);
      }
    
    Symbol symbol = getSymbolFromTable(ast_method);

    if (symbol == null)
      throw new RuntimeException("No method (" + ast_method + ") declared");

    if (symbol instanceof SymbolMethod){
      SymbolMethod method = (SymbolMethod) symbol;
      symbol = getSymbolFromTable(ast_identifier);
      if (symbol instanceof SymbolVar) {
        SymbolVar var = (SymbolVar) symbol;
        if(!var.isInitialized) {
          throw new RuntimeException("Variable " + ast_identifier + " hasn't been initialized.");
        }
        if (!var.type.equals(method.className)) {
          throw new RuntimeException("Object " + ast_identifier + " has no method " + ast_method);
        }

        List<String> argsType = new ArrayList<>();
     
        if(this.children != null && ((SimpleNode)this.children[0]).children != null) {
          for (int j = 0; j < ((SimpleNode)this.children[0]).children.length; j++) {
            argsType.add(((SimpleNode)((SimpleNode)(this.children[0])).children[j]).getType());
            // ASTArguments args = (ASTArg)((SimpleNode)(this.children[0])).children[j];
            // String type = arg.ast_type;
            // String identifier = arg.ast_id;
            // SymbolVar symbol = new SymbolVar(identifier, type);
            // symbol.initialize();
            // args.add(symbol);
          }
        }

        for (int i = 0; i < method.arguments.size(); i++){
          if (!method.arguments.get(i).type.equals(argsType.get(i)))
            throw new RuntimeException("Method args do not match " + method.arguments.get(i).type + "has no method " + argsType.get(i));
        }

      } else {
        throw new RuntimeException("ASTAcessMethod identifier (" + ast_identifier + ") not a var");
      }

    } else {
      throw new RuntimeException("ASTAcessMethod is not a method");
    }

    return 1;
  }

  public String getNodeType() {
    return this.getClass().toString();
  }
}
/* JavaCC - OriginalChecksum=5a72632e1aaebf06ca4ffdc6eef531b9 (do not edit this line) */
